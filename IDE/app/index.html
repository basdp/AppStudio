<html>
<head>
  <title>AppStudio</title>
	<meta charset="utf-8">
    <link type="text/css" rel="stylesheet" href="main.min.css" />
    <script>
        if (window.require !== undefined) {       
            var os = require('os');
            var isWindows8 = os.platform() == 'win32' && (os.release().indexOf('6.2') === 0 || os.release().indexOf('6.3') === 0);

            var gui = require('nw.gui');
            var win = gui.Window.get();            
            window.isMaximized = false;
            win.on('maximize', function(e) { 
                if (isWindows8) {
                    win.unmaximize();
                    setTimeout(function() {
                        window.isMaximized = false;
                        MaximizeWorkaround();
                    }, 50);
                } else {
                    window.isMaximized = true;
                }
                                       
            });
            win.on('unmaximize', function(e) { window.isMaximized = false; });
                        
            function MaximizeWorkaround() {
                if (isWindows8) {
                    if (!window.isMaximized) {
                        window.oldDimensions = { x: win.x, y: win.y, width: win.width, height: win.height };
                        win.resizeTo(screen.availWidth, screen.availHeight);
                        win.moveTo(0, 0); 
                        window.isMaximized = true;
                        win.setResizable(false);
                        document.querySelector('.windowdrag').classList.remove('draggable');
                    } else {
                        win.resizeTo(window.oldDimensions.width, window.oldDimensions.height);
                        win.moveTo(window.oldDimensions.x, window.oldDimensions.y);
                        window.isMaximized = false;
                        win.setResizable(true);
                        document.querySelector('.windowdrag').classList.add('draggable');
                    }
                } else {
                    if (window.isMaximized) {
                        win.unmaximize();
                    } else {
                        win.maximize();
                    }
                }
            }

            gui.Window.get().on('close', function() {
                var tabbar = document.getElementById('tabbar');
                var alltabs = tabbar.querySelectorAll("li");
                var dirtyfiles = [];
                Array.prototype.forEach.call(alltabs, function(el, i) {
                    if (el.classList.contains('dirty')) {
                        dirtyfiles.push({ filename: el.getAttribute('data-filename'), iframe: el.iframe, tab: el });
                    }
                });
                
                var win = this;
                
                function check_project() {
                    if (project.dirty) {
                        show_messagebox('Project \'' + project.name + '\' is not saved, do you want to save?', "Project not saved",
                                        [{ title: 'Yes', value: 'yes', default: true }, { title: 'No', value: 'no' }, { title: 'Cancel', value: 'cancel' }],
                                        function(val) {
                                            if (val === 'yes') {
                                                project_save();
                                            }

                                            if (val === 'cancel') return;

                                            win.close(true);
                                        }
                        );
                    } else {
                        win.close(true);   
                    }              
                }
                
                function check_file(i) {
                    select_tab(dirtyfiles[i].filename);
                    show_messagebox(dirtyfiles[i].filename + ' is not saved, do you want to save?', "File not saved",
                                    [{ title: 'Yes', value: 'yes', default: true }, { title: 'No', value: 'no' }, { title: 'Cancel', value: 'cancel' }],
                                    function(val) {
                                        if (val === 'yes') {
                                            dirtyfiles[i].iframe.contentWindow.dispatchEvent(new CustomEvent('save', { 'detail': { require: require } } ));
                                        }
                                        
                                        if (val === 'cancel') return;

                                        if (i + 1 < dirtyfiles.length) {
                                            con(i + 1);
                                        } else {
                                            // all files saved
                                            check_project();
                                        }
                                    }
                    );
                }
                
                if (dirtyfiles.length > 0) check_file(0); else check_project();
            });
			
			if (process.platform === 'darwin') {
				var fileref=document.createElement("link");
				fileref.setAttribute("rel", "stylesheet");
				fileref.setAttribute("type", "text/css");
				fileref.setAttribute("href", 'mac.css');
				document.getElementsByTagName("head")[0].appendChild(fileref);
			}
        } 
        
        function setTitle(title) {
            document.getElementsByTagName('title')[0].textContent = title;
            document.querySelector('header .title').textContent = title;
        }
        
        window.addEventListener('DOMContentLoaded', function(){
            //new_tab("appstudio://getting-started", "Getting Started", true, webbrowsereditor); 
            new_tab("gettingstarted.html", "Getting Started", true, webbrowsereditor);
            
            setTitle('AppStudio');
            
            project_loadprojectfile('demoproject/demoproject.proj');
        });
    </script>
    <script src="fullheight.js"></script>
    <script src="treeview.js"></script>
    <script src="menus.js"></script>
    <script src="project.js"></script>
	<script src="files.js"></script>
	<script src="tabs.js"></script>
	<script src="editors.js"></script>
	<script src="messagebox.js"></script>

</head>
<body>
	<input style="display:none;" id="fileOpenDialog" type="file" />
	<input style="display:none;" id="fileSaveDialog" type="file" nwsaveas />
    <input style="display:none;" id="directorySelectDialog" type="file" nwdirectory />
	
    <header>
        <div class="windowdrag draggable"></div>
        <div class="title">Main App *</div>
        <div class="windowbuttons">
            <button class="close" onclick="win.close()"><img src="images/close.png"></button>
            <button class="maximize" onclick="MaximizeWorkaround()"><img src="images/maximize.png"></button>
            <button class="minimize" onclick="win.minimize()"><img src="images/minimize.png"></button>
        </div>
        <div id="menu"></div>
        
        <ul id="windowsmenubar">
            <li onclick="openmenu('file', this)">File</li>
            <li onclick="openmenu('edit', this)">Edit</li>
            <li onclick="openmenu('project', this)">Project</li>
            <li onclick="openmenu('build', this)">Build</li>
            <li onclick="openmenu('team', this)">Team</li>
            <li onclick="openmenu('tools', this)">Tools</li>
            <li onclick="openmenu('help', this)">Help</li>
        </ul>
    </header>
    
    <ul id="tabbar">
    </ul>
    
    <div class="toolbar-container"><ul id="toolbar">
		<div class="tools-js">
			<li class="tools-save"><img src="images/icons/save.png"></li>
			<hr>
			<li><img src="images/icons/cut.png"></li>
			<li><img src="images/icons/copy.png"></li>
			<li><img src="images/icons/paste.png"></li>
			<hr>
			<li><img src="images/icons/search.png"></li>
			<li><img src="images/icons/info.png"></li>
			<li><img src="images/icons/book.png"></li>
			<li><img src="images/icons/comment.png"></li>
		</div>
		
		<div class="tools-xml">
			<li><img src="images/icons/save.png"></li>
			<hr>
			<li><img src="images/icons/cut.png"></li>
			<li><img src="images/icons/copy.png"></li>
			<li><img src="images/icons/paste.png"></li>
			<hr>
			<li><img src="images/icons/search.png"></li>
			<li><img src="images/icons/info.png"></li>
			<li><img src="images/icons/book.png"></li>
			<li><img src="images/icons/comment.png"></li>
		</div>
		
		<div class="tools-web">
			<li id="tools-web-back"><img src="images/icons/back.png"></li>
			<li id="tools-web-forward"><img src="images/icons/forward.png"></li>
			<hr>
			<li id="tools-web-reload"><img src="images/icons/reload.png"></li>
			<hr>
			<input id="tools-web-addressbar" />
		</div>
    </ul></div>
    
    <ul id="palettebar" class="full-height">
        <li id="palettebarhandle"></li>
        <li><img src="images/icons/save.png"></li>
        <hr>
        <li><img src="images/icons/cut.png"></li>
        <li><img src="images/icons/copy.png"></li>
        <li><img src="images/icons/paste.png"></li>
        <li><img src="images/icons/search.png"></li>
        <li><img src="images/icons/info.png"></li>
        <li><img src="images/icons/book.png"></li>
        <li><img src="images/icons/comment.png"></li>
    </ul>
    
    <div id="content">
       <div class="empty" id="emptycontent"></div>
    </div>
    
    <div class="projectbar-container"><div id="projectbar">
        <div class="title"><img src="images/sidebar-open.png" /> Project</div>
        <div class="projecttree">
            <ul class="treeview" style="height: 200px;"></ul>
        </div>
        <div class="title"><img src="images/sidebar-closed.png" /> Team</div>
        hoi
    </div></div>
    
    <div class="sidebar-container"><div id="sidebar">
        <div class="title"><img src="images/sidebar-open.png" /> Inspector</div>
        <div id="inspector">
            <div class="name">
                <div class="icon"><img src="images/grid.png"/></div>
                <div class="row"><label for="name">Name</label><input name="name" /></div>
                <div class="row"><label for="type">Type</label><span>Grid</span></div>
            </div>
            <div class="scrollarea" style="height: 200px">
                <div class="section">
                    <div class="name">Layout</div>
                    <div class="row"><label for="name">Width</label><input name="name" /></div>
                    <div class="row"><label for="name">Height</label><input name="name" /></div>
                    <div class="row"><label for="name">Margin</label>
                        <span class="iconinput"><img src="images/arrow-1-up.png"><input name="name" class="half" /></span>
                        <span class="iconinput"><img src="images/arrow-1-right.png"><input name="name" class="half" /></span>
                    </div>
                    <div class="row"><label for="name">&nbsp;</label>
                        <span class="iconinput"><img src="images/arrow-1-down.png"><input name="name" class="half" /></span>
                        <span class="iconinput"><img src="images/arrow-1-left.png"><input name="name" class="half" /></span>
                    </div>
                </div>
                <div class="section">
                    <div class="name">Dimensions</div>
                    <div class="row"><label for="name">Name</label><input name="name" /></div>
                    <div class="row"><label for="name">Name</label><input name="name" /></div>
                </div>
                <div class="section">
                    <div class="name">Dimensions</div>
                    <div class="row"><label for="name">Name</label><input name="name" /></div>
                    <div class="row"><label for="name">Name</label><input name="name" /></div>
                </div>
            </div>
        </div>
        <div class="title"><img src="images/sidebar-closed.png" /> Documentation</div>
        hoi
    </div></div>
    
</body>
</html>
